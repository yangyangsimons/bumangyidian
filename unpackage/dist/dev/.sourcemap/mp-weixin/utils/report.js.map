{"version":3,"file":"report.js","sources":["../../../../../../../Applications/HBuilderX.app/Contents/HBuilderX/plugins/uniapp-cli-vite/__vite-browser-external:stream/consumers","utils/report.js"],"sourcesContent":["export default new Proxy({}, {\n  get(_, key) {\n    throw new Error(`Module \"stream/consumers\" has been externalized for browser compatibility. Cannot access \"stream/consumers.${key}\" in client code.  See https://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n  }\n})","import { json } from 'stream/consumers'\nimport { baseUrl } from './config'\nlet commonParams = null\n\n// type: 'pv' | 'show' | 'click' | 'st',\n// data: any = {},\n// options: any = {}\nlet _pages_ = getApp().globalData._pages\nexport async function dmReport(type, data = {}, options = {}) {\n  const pages = getCurrentPages()\n  // const route = pages[pages.length - 1]\n  // switch (_pages_[_pages_.length - 1]) {\n  //   case 'pages/home/home':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitHome'\n  //     break\n  //   case 'pages/my/my':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitMy'\n  //     break\n  //   case 'pages/template-use/template-use':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitcreate'\n  //     break\n  //   case 'pages/ai-generator-index/ai-generator-index':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitList'\n  //     break\n  //   case 'pages/hd-page/hd-page':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitDetail'\n  //     break\n  //   case 'pages/edit_photo/index':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitEditIDPhoto'\n  //     break\n  //   default:\n  //     break\n  // }\n  // console.log('pages_____', _pages_)\n  const token = uni.getStorageSync('token') || ''\n\n  // 设置请求头，加入token\n  const defaultHeader = {\n    'Content-Type': 'application/json',\n    Authorization: token ? `bearer ${token}` : '', // 常见的token携带方式\n    is_yk: token ? '0' : '1',\n  }\n  const systemData = JSON.stringify({\n    event: type,\n    lob: data,\n    // lastpage: _pages_[_pages_.length - 1] || '',\n    ...(await getCommonParams()), // 公共参数\n    ...options,\n  })\n  uni.request({\n    method: 'POST',\n    url: `${baseUrl}/track/send`,\n    data: JSON.stringify({\n      lastp: 'index',\n      event: type,\n      lob: data,\n      network: await getNetworkType(),\n      // lastpage: _pages_[_pages_.length - 1] || '',\n      ...(await getCommonParams()), // 公共参数\n      ...options,\n    }),\n    header: defaultHeader,\n  })\n}\n\nasync function getNetworkType() {\n  return new Promise((resolve) => {\n    uni.getNetworkType({\n      complete: (res) => resolve(res.networkType || ''),\n    })\n  })\n}\n\nasync function getCommonParams() {\n  if (commonParams) return commonParams\n  return new Promise((resolve) => {\n    uni.getSystemInfo({\n      success: async (res) => {\n        const sessionid = Date.now() + Math.random().toString(36).substring(2)\n        const launchParams = uni.getLaunchOptionsSync()\n        const rch = launchParams?.query?.rch || ''\n\n        commonParams = {\n          sessionid,\n          rch,\n          dist_ch: 'SHXZ-WX',\n          platform: 'miniprogram',\n          did: res.deviceId,\n          width: res.screenWidth,\n          height: res.screenHeight,\n          ts: Date.now(),\n          app_ver: res.appVersion,\n          os: res.system?.split(' ')[0],\n          os_ver: res.system?.split(' ')[1],\n          model: res.model,\n          net: await getNetworkType(),\n        }\n        resolve(commonParams)\n      },\n    })\n  })\n}\n"],"names":["uni","baseUrl"],"mappings":";;;AAAe,IAAI,MAAM,CAAA,GAAI;AAAA,EAC3B,IAAI,GAAG,KAAK;AACV,UAAM,IAAI,MAAM,8GAA8G,GAAG,sIAAsI;AAAA,EACxQ;AACH,CAAC;ACFD,IAAI,eAAe;AAKL,OAAQ,EAAC,WAAW;AAC3B,eAAe,SAAS,MAAM,OAAO,CAAA,GAAI,UAAU,CAAA,GAAI;AAC9C,kBAAiB;AAyB/B,QAAM,QAAQA,cAAG,MAAC,eAAe,OAAO,KAAK;AAG7C,QAAM,gBAAgB;AAAA,IACpB,gBAAgB;AAAA,IAChB,eAAe,QAAQ,UAAU,KAAK,KAAK;AAAA;AAAA,IAC3C,OAAO,QAAQ,MAAM;AAAA,EACtB;AACkB,OAAK,UAAU;AAAA,IAChC,OAAO;AAAA,IACP,KAAK;AAAA;AAAA,IAEL,GAAI,MAAM,gBAAiB;AAAA;AAAA,IAC3B,GAAG;AAAA,EACP,CAAG;AACDA,gBAAAA,MAAI,QAAQ;AAAA,IACV,QAAQ;AAAA,IACR,KAAK,GAAGC,aAAO,OAAA;AAAA,IACf,MAAM,KAAK,UAAU;AAAA,MACnB,OAAO;AAAA,MACP,OAAO;AAAA,MACP,KAAK;AAAA,MACL,SAAS,MAAM,eAAgB;AAAA;AAAA,MAE/B,GAAI,MAAM,gBAAiB;AAAA;AAAA,MAC3B,GAAG;AAAA,IACT,CAAK;AAAA,IACD,QAAQ;AAAA,EACZ,CAAG;AACH;AAEA,eAAe,iBAAiB;AAC9B,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9BD,kBAAAA,MAAI,eAAe;AAAA,MACjB,UAAU,CAAC,QAAQ,QAAQ,IAAI,eAAe,EAAE;AAAA,IACtD,CAAK;AAAA,EACL,CAAG;AACH;AAEA,eAAe,kBAAkB;AAC/B,MAAI;AAAc,WAAO;AACzB,SAAO,IAAI,QAAQ,CAAC,YAAY;AAC9BA,kBAAAA,MAAI,cAAc;AAAA,MAChB,SAAS,OAAO,QAAQ;;AACtB,cAAM,YAAY,KAAK,IAAG,IAAK,KAAK,OAAQ,EAAC,SAAS,EAAE,EAAE,UAAU,CAAC;AACrE,cAAM,eAAeA,cAAG,MAAC,qBAAsB;AAC/C,cAAM,QAAM,kDAAc,UAAd,mBAAqB,QAAO;AAExC,uBAAe;AAAA,UACb;AAAA,UACA;AAAA,UACA,SAAS;AAAA,UACT,UAAU;AAAA,UACV,KAAK,IAAI;AAAA,UACT,OAAO,IAAI;AAAA,UACX,QAAQ,IAAI;AAAA,UACZ,IAAI,KAAK,IAAK;AAAA,UACd,SAAS,IAAI;AAAA,UACb,KAAI,SAAI,WAAJ,mBAAY,MAAM,KAAK;AAAA,UAC3B,SAAQ,SAAI,WAAJ,mBAAY,MAAM,KAAK;AAAA,UAC/B,OAAO,IAAI;AAAA,UACX,KAAK,MAAM,eAAgB;AAAA,QAC5B;AACD,gBAAQ,YAAY;AAAA,MACrB;AAAA,IACP,CAAK;AAAA,EACL,CAAG;AACH;;"}