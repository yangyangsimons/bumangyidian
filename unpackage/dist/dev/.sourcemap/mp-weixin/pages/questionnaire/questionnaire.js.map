{"version":3,"file":"questionnaire.js","sources":["pages/questionnaire/questionnaire.vue","pages/questionnaire/questionnaire.vue?type=page"],"sourcesContent":["<template>\n  <view class=\"questionnaire-container\">\n    <image class=\"global-title\" src=\"../../static/global-title.png\"></image>\n    <view class=\"header\">\n      <view class=\"title\">\n        <text>你的 MBTI 是什么</text>\n        <view class=\"bar\"></view>\n      </view>\n      <text class=\"describe\">让我们更懂你一点</text>\n    </view>\n    <view class=\"main\">\n      <view class=\"mbti-container\">\n        <view\n          v-for=\"(value, key) in options\"\n          :key=\"key\"\n          class=\"mbti-item\"\n          :class=\"{ active: selectedMbti === key }\"\n          @click=\"selectMBTI(key)\"\n        >\n          <text class=\"mbti-title\">{{ key }}</text>\n          <text class=\"mbti-text\">{{ value }}</text>\n        </view>\n      </view>\n    </view>\n    <view class=\"footer\">\n      <button class=\"next\" @click=\"handleNext\">\n        <text class=\"next-text\">开启</text>\n      </button>\n      <view class=\"skip\" @click=\"skip\"\n        ><text>不知道，跳过</text>\n        <image class=\"skip-icon\" src=\"../../static/skip.png\" mode=\"scaleToFill\"\n      /></view>\n    </view>\n  </view>\n</template>\n\n<script setup>\n  import { ref, computed } from 'vue'\n  import { onLoad, onUnload, onShow, onHide } from '@dcloudio/uni-app'\n  import { baseUrl } from '@/utils/config'\n  import request from '@/utils/request'\n\n  const options = ref({})\n  const sex = ref('') // 记录性别\n  const birth = ref('') // 记录出生日期\n  const selectedMbti = ref('') // 记录选中的MBTI类型的key\n  const selectedMbtiValue = ref('') // 记录选中的MBTI类型的value\n  const question_id = ref('') // 记录问题ID\n  const question_text = ref('') // 记录问题文本\n  const changeMbti = ref(false) // 记录MBTI类型\n  onLoad((param) => {\n    // 页面加载时的逻辑\n    console.log('页面加载questionnaire', param)\n    if (param.changeMbti !== undefined) {\n      changeMbti.value = true\n    }\n  })\n  onShow(async () => {\n    // 页面显示时的逻辑\n    console.log('页面显示questionnaire')\n    try {\n      const res = await request(`${baseUrl}/user/question`, 'GET')\n      console.log('获取问卷数据', res)\n      if (res.code === 0) {\n        question_id.value = res.data[0].id\n        options.value = res.data[0].options\n        question_text.value = res.data[0].question_text\n      }\n    } catch (e) {\n      console.error('获取问卷数据失败', e)\n      uni.showToast({\n        title: '网络异常，请稍后再试',\n        icon: 'none',\n      })\n    }\n  })\n\n  const selectMBTI = (key, value) => {\n    selectedMbti.value = key\n    selectedMbtiValue.value = options.value[key]\n    console.log('选择了MBTI:', key, selectedMbtiValue.value)\n  }\n\n  const handleNext = async () => {\n    if (changeMbti.value) {\n      console.log(selectedMbtiValue.value)\n      const res = await request(`${baseUrl}/user/update_mbti`, 'POST', {\n        mbti: selectedMbtiValue.value,\n      })\n      uni.reLaunch({ url: '/pages/index/index' })\n      return\n    }\n    // 处理下一步逻辑\n    uni.getStorage({\n      key: 'sex',\n      success: ({ data }) => {\n        console.log('获取到的性别:', data)\n        if (data == 'male') {\n          sex.value = '男'\n        } else {\n          sex.value = '女'\n        }\n        console.log('获取到的出生日期:', birth.value)\n      },\n      fail: (error) => {\n        console.error('获取性别失败', error)\n        return\n      },\n    })\n    uni.getStorage({\n      key: 'birth',\n      success: async ({ data }) => {\n        birth.value = data\n        if (selectedMbti.value) {\n          console.log('提交选择', selectedMbti.value, selectedMbtiValue.value)\n          try {\n            const res = await request(`${baseUrl}/user/register`, 'POST', {\n              sex: sex.value,\n              birth: birth.value,\n              username: '李思明',\n              avator: 'http://avatar1',\n              answers: [\n                {\n                  question_id: question_id.value,\n                  option: [selectedMbtiValue.value],\n                },\n              ],\n            })\n            console.log('提交问卷结果', res)\n            if (res.code == 0) {\n              uni.reLaunch({ url: '/pages/index/index' })\n            }\n          } catch (e) {\n            console.error('提交问卷结果失败', e)\n            uni.showToast({\n              title: '网络异常，请稍后再试',\n              icon: 'none',\n            })\n          }\n          // 这里可以添加提交数据或跳转逻辑\n        } else {\n          uni.showToast({\n            title: '请先选择一个MBTI类型',\n            icon: 'none',\n          })\n        }\n      },\n      fail: (error) => {\n        console.error('获取出生日期失败', error)\n        return\n      },\n    })\n  }\n\n  const skip = async () => {\n    if (changeMbti.value) {\n      uni.reLaunch({ url: '/pages/index/index' })\n      return\n    }\n    // 处理下一步逻辑\n    uni.getStorage({\n      key: 'sex',\n      success: ({ data }) => {\n        console.log('获取到的性别:', data)\n        if (data == 'male') {\n          sex.value = '男'\n        } else {\n          sex.value = '女'\n        }\n        console.log('获取到的出生日期:', birth.value)\n      },\n      fail: (error) => {\n        console.error('获取性别失败', error)\n        return\n      },\n    })\n    uni.getStorage({\n      key: 'birth',\n      success: async ({ data }) => {\n        birth.value = data\n        try {\n          const res = await request(`${baseUrl}/user/register`, 'POST', {\n            sex: sex.value,\n            birth: birth.value,\n            username: '李思明',\n            avator: 'http://avatar1',\n            answers: [],\n          })\n          console.log('提交问卷结果', res)\n          if (res.code == 0) {\n            uni.reLaunch({ url: '/pages/index/index' })\n          }\n        } catch (e) {\n          console.log('提交问卷结果失败', e)\n          uni.showToast({\n            title: '网络异常，请稍后再试',\n            icon: 'none',\n          })\n        }\n      },\n      fail: (error) => {\n        console.error('获取出生日期失败', error)\n        return\n      },\n    })\n  }\n</script>\n\n<style lang=\"scss\" scoped>\n  @import 'index.scss';\n\n  // 如果在index.scss中没有定义active样式，可以在这里添加\n</style>\n","import MiniProgramPage from '/Users/lynnyang/work/project/xjlab/HBuilderProjects/bumangyidian/pages/questionnaire/questionnaire.vue'\nwx.createPage(MiniProgramPage)"],"names":["ref","onLoad","uni","onShow","request","baseUrl"],"mappings":"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"}