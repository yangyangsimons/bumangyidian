{"version":3,"file":"user-popup.js","sources":["components/user-popup/user-popup.vue","/Users/lynnyang/work/project/xjlab/HBuilderProjects/bumangyidian/components/user-popup/user-popup.vue?type=component"],"sourcesContent":["<template>\n  <uni-popup @change=\"popupChange\" ref=\"userPopupRef\">\n    <view class=\"user-container\">\n      <image\n        class=\"bg\"\n        src=\"../../static/user-info-bg.png\"\n        mode=\"scaleToFill\"\n      />\n      <view class=\"header\">\n        <image class=\"avator\" :src=\"avator\" @click=\"changeAvator\"></image>\n        <view class=\"user-info\">\n          <view class=\"name\"\n            >{{ userName }}\n            <image\n              class=\"change\"\n              src=\"../../static/change.png\"\n              @click=\"changeName\"\n            ></image>\n          </view>\n          <view class=\"info-container\">\n            <view class=\"age\">{{ userAge }}岁</view>\n            <view class=\"sex\">\n              <image class=\"sex-icon\" :src=\"sexSrc\"></image>\n            </view>\n            <view class=\"mbti\">\n              <view class=\"mbti-name\">{{ userMbti }}</view>\n              <view class=\"mbti-short\">{{ userMbtiShort }}</view>\n            </view>\n            <image\n              class=\"change\"\n              src=\"../../static/change.png\"\n              @click=\"changeMbti\"\n            ></image>\n          </view>\n        </view>\n      </view>\n      <view class=\"main\">\n        <view class=\"title\">\n          <text class=\"name\">切换音色</text>\n          <view class=\"bar\"></view>\n        </view>\n        <view class=\"tones-container\">\n          <view\n            v-for=\"(item, index) in tones\"\n            :key=\"index\"\n            class=\"tone-container\"\n            :class=\"{ active: item.active }\"\n            @click=\"toneClick(item.id, index)\"\n          >\n            <view class=\"image-container\">\n              <image class=\"tone\" :src=\"item.icon\" mode=\"scaleToFill\"></image>\n              <view class=\"check\">\n                <image\n                  class=\"check-icon\"\n                  src=\"../../static/check.png\"\n                  mode=\"scaleToFill\"\n                ></image>\n              </view>\n            </view>\n            <view class=\"describe\">\n              <text class=\"name\">{{ item.name }}</text>\n              <text class=\"style\">{{ item.style }}</text>\n            </view>\n          </view>\n        </view>\n      </view>\n      <view class=\"footer\">\n        <!-- <button class=\"try\" @click=\"tryListen\">试听音色</button> -->\n        <button class=\"confirm\" @click=\"updateTone\">确认</button>\n      </view>\n    </view>\n  </uni-popup>\n</template>\n\n<script setup>\n  import { ref, defineExpose, defineEmits } from 'vue'\n  import { onLoad, onUnload, onShow, onHide } from '@dcloudio/uni-app'\n  import request from '@/utils/request'\n  import { baseUrl } from '../../utils/config'\n  import { useWebSocketStore } from '@/stores/websocket'\n  import { useBarrageStore } from '../../stores/barrage'\n  import { useModelStore } from '../../stores/model'\n  // 导入音频播放器状态管理\n  import { useAudioPlayerStore } from '@/stores/audioPlayer'\n  import { useToggleModelStore } from '../../stores/toggleModelStore'\n  import { dmReport } from '../../utils/report'\n\n  const modelStore = useModelStore()\n  const toggleModelStore = useToggleModelStore()\n  const wsStore = useWebSocketStore()\n  // 初始化音频播放器状态管理\n  const audioPlayerStore = useAudioPlayerStore()\n  // 初始化弹幕状态管理\n  const barrageStore = useBarrageStore()\n\n  const currentTone = ref(null)\n  const tones = ref([])\n  const toneId = ref(null)\n  // 添加音频播放器引用\n  const audioPlayer = ref(null)\n  // 记录当前选中的音色ID\n  const selectedToneId = ref(null)\n  const currentTonePath = ref(null)\n\n  //用户信息\n  const user = ref(null)\n  const userName = ref('') // 用户名\n  const userSex = ref('') // 用户性别\n  const userAge = ref('') // 用户年龄\n  const userMbti = ref('') // 用户MBTI类型\n  const userMbtiShort = ref('') // 用户MBTI类型简称\n  const avator = ref('') // 用户头像\n  const sexSrc = ref('') // 用户性别图标路径\n  const sptime = ref(0)\n  onShow(async () => {\n    // 页面显示时，获取用户信息\n    try {\n      const toneRes = await request(`${baseUrl}/tone/query`, 'get')\n      if (toneRes.code === 0) {\n        console.log('获取音色信息成功', toneRes.data)\n        tones.value = toneRes.data\n        // 处理音色信息\n        // 例如：将音色信息存储到状态管理中\n      } else {\n        console.error('获取音色信息失败', toneRes.message)\n      }\n    } catch (e) {\n      console.error('获取音色信息失败', e)\n    }\n  })\n\n  //处理用户出生日期\n  const calculateAge = (birthDateString) => {\n    if (!birthDateString) return 0 // 处理空值\n    const parts = birthDateString.split('-')\n    if (parts.length !== 3) return 0 // 处理无效格式\n\n    const birthYear = parseInt(parts[0], 10)\n    const birthMonth = parseInt(parts[1], 10)\n    const birthDay = parseInt(parts[2], 10)\n\n    // 验证是否为有效日期\n    if ([birthYear, birthMonth, birthDay].some(isNaN)) return 0\n\n    const today = new Date()\n    const currentYear = today.getFullYear()\n    const currentMonth = today.getMonth() + 1 // 月份从0开始，需+1\n    const currentDay = today.getDate()\n\n    let age = currentYear - birthYear\n\n    // 如果当前月份小于出生月份，或月份相同但日期未到，年龄减1\n    if (\n      currentMonth < birthMonth ||\n      (currentMonth === birthMonth && currentDay < birthDay)\n    ) {\n      age--\n    }\n\n    return age\n  }\n  const toneClick = (id, index) => {\n    // 点击音色时的处理逻辑\n    console.log('点击音色', id, index)\n    tones.value.forEach((item, i) => {\n      item.active = i === index\n    })\n    selectedToneId.value = id\n    currentTone.value = tones.value[index]\n\n    // 查找对应的音色项\n    const selectedTone = tones.value.find((item) => item.id === id)\n    //更新音色试听的path\n    if (selectedTone) {\n      console.log('选中的音色', selectedTone)\n      //上报选中音色\n      dmReport(\n        'click',\n        {},\n        {\n          page: 'userInfo',\n          contents: [\n            {\n              element_id: 'content',\n              element_content: `${selectedTone.name}`,\n            },\n          ],\n        }\n      )\n      currentTonePath.value = selectedTone.path\n    } else {\n      console.error('未找到对应的音色项')\n    }\n    tryListen()\n  }\n\n  // 播放音频的函数\n  const playAudio = (path) => {\n    // 确保每次都创建新的音频上下文，避免同时播放多个音频\n    if (audioPlayer.value) {\n      audioPlayer.value.stop()\n      audioPlayer.value.destroy()\n    }\n\n    audioPlayer.value = uni.createInnerAudioContext()\n    audioPlayer.value.onError((res) => {\n      console.error('音频播放错误', res)\n    })\n\n    // 设置音频源\n    audioPlayer.value.src = path\n\n    // 播放音频\n    audioPlayer.value.play()\n    // 添加音频播放完成事件监听\n    audioPlayer.value.onEnded(() => {\n      console.log('试听音频播放完成')\n      // 播放完成后，继续播放原来的音频\n      audioPlayerStore.setTtsVolume(1)\n    })\n    audioPlayer.value.onPlay(() => {\n      console.log('试听音频开始播放')\n      audioPlayerStore.setTtsVolume(0)\n    })\n  }\n\n  // 试听按钮点击事件\n  const tryListen = () => {\n    // 试听音色的处理逻辑\n    // audioPlayerStore.reportCurrentProgress()\n    audioPlayerStore.setTtsVolume(0.1)\n    // barrageStore.clearMessages()\n    // console.log('清空消息列表')\n    if (currentTone.value && currentTonePath.value) {\n      playAudio(currentTonePath.value)\n    } else {\n      uni.showToast({\n        title: '请先选择音色',\n        icon: 'none',\n      })\n    }\n  }\n\n  // 更新音色按钮点击事件\n  const updateTone = async () => {\n    dmReport(\n      'click',\n      {},\n      {\n        page: 'userInfo',\n        contents: [\n          {\n            element_id: 'content',\n            element_content: `确认`,\n          },\n        ],\n      }\n    )\n    if (!selectedToneId.value) {\n      uni.showToast({\n        title: '请先选择音色',\n        icon: 'none',\n      })\n      return\n    }\n    if (audioPlayer.value) {\n      audioPlayer.value.stop()\n      audioPlayer.value.destroy()\n    }\n    audioPlayer.value = null\n    audioPlayerStore.setTtsVolume(1)\n    console.log('更新音色', selectedToneId.value)\n    //先判断是不是选择了id为6的音色，这是金种子，不更新给后台\n    if (selectedToneId.value == 6 && modelStore.model !== '金种子杯模式') {\n      // 选中的是音色6，触发模式切换逻辑\n      console.log(\n        '选了金种子，直接切换模式，不更新音色了',\n        selectedToneId.value\n      )\n      toggleModelStore.triggerModelChange()\n      return\n    }\n    if (selectedToneId.value == 6 && modelStore.model == '金种子杯模式') {\n      //金种子杯模式下，选中的是音色6，什么都不做；\n      console.log(\n        '金种子杯模式下选中的是音色6，什么都不做',\n        selectedToneId.value\n      )\n    }\n\n    const res = await request(`${baseUrl}/tone/update`, 'post', {\n      tone_id: selectedToneId.value,\n    })\n    if (res.code === 0) {\n      audioPlayerStore.setTtsVolume(1)\n\n      console.log('触发模式切换逻辑', selectedToneId.value)\n      console.log('触发模式切换逻辑', modelStore.model)\n\n      uni.showToast({\n        title: '音色更新成功',\n        icon: 'success',\n      })\n      if (modelStore.model == '金种子杯模式' && selectedToneId.value !== 6) {\n        // 选中的是音色不是6，触发模式切换逻辑\n        console.log(\n          '金种子杯模式下面选了不是6的音色，触发模式切换逻辑',\n          selectedToneId.value\n        )\n        toggleModelStore.triggerModelChange()\n      }\n    } else {\n      uni.showToast({\n        title: '请稍后再试',\n        icon: 'none',\n      })\n    }\n  }\n\n  //更换头像\n  // 更换头像\n  const changeAvator = async () => {\n    dmReport(\n      'click',\n      {},\n      {\n        page: 'userInfo',\n        contents: [\n          {\n            element_id: 'content',\n            element_content: `修改头像`,\n          },\n        ],\n      }\n    )\n    uni.chooseImage({\n      count: 1,\n      success: async (res) => {\n        console.log('选择的头像', res.tempFilePaths[0])\n        const avatorFile = res.tempFilePaths[0]\n\n        // 读取文件内容并转换为base64\n        uni.getFileSystemManager().readFile({\n          filePath: avatorFile,\n          encoding: 'base64',\n          success: async (readRes) => {\n            // 获取base64数据\n            const base64String = readRes.data\n\n            // 上传头像\n            try {\n              const uploadResult = await request(\n                `${baseUrl}/user/upload_avatar`,\n                'POST',\n                {\n                  pic_base64: base64String,\n                }\n              )\n              console.log('头像上传成功', uploadResult)\n              uni.showToast({\n                title: '头像更新成功',\n                icon: 'success',\n              })\n              avator.value = uploadResult.data.avator_url\n            } catch (error) {\n              console.error('头像上传失败', error)\n              uni.showToast({\n                title: '头像更新成功',\n                icon: 'success',\n              })\n            }\n          },\n          fail: (error) => {\n            console.error('读取文件失败', error)\n            uni.showToast({\n              title: '头像更新成功',\n              icon: 'success',\n            })\n          },\n        })\n      },\n      fail: (error) => {\n        console.error('选择头像失败', error)\n      },\n    })\n  }\n  //更换名字\n  const changeName = async () => {\n    dmReport(\n      'click',\n      {},\n      {\n        page: 'userInfo',\n        contents: [\n          {\n            element_id: 'content',\n            element_content: `修改昵称`,\n          },\n        ],\n      }\n    )\n    uni.showModal({\n      title: '修改昵称（不超过9个字）',\n      editable: true,\n      placeholderText: '请输入新的昵称',\n      content: userName.value,\n      success: async (res) => {\n        if (res.confirm && res.content) {\n          // 验证名称长度\n          if (res.content.length > 10) {\n            uni.showToast({\n              title: '昵称不能超过20个字符',\n              icon: 'none',\n            })\n            return\n          }\n\n          try {\n            const result = await request(\n              `${baseUrl}/user/update_username`,\n              'POST',\n              {\n                username: res.content,\n              }\n            )\n\n            if (result.code === 0) {\n              // 更新本地显示的用户名\n              userName.value = res.content\n              uni.showToast({\n                title: '昵称修改成功',\n                icon: 'success',\n              })\n              // 更新全局用户状态\n              const modelStore = useModelStore()\n              if (modelStore.userInfo) {\n                modelStore.updateUserInfo({ username: res.content })\n              }\n            } else {\n              uni.showToast({\n                title: result.message || '修改失败',\n                icon: 'none',\n              })\n            }\n          } catch (error) {\n            console.error('修改昵称失败', error)\n            uni.showToast({\n              title: '网络错误，请稍后再试',\n              icon: 'none',\n            })\n          }\n        }\n      },\n    })\n  }\n  //更换mbti\n  const changeMbti = async () => {\n    dmReport(\n      'click',\n      {},\n      {\n        page: 'userInfo',\n        contents: [\n          {\n            element_id: 'content',\n            element_content: `修改MBTI`,\n          },\n        ],\n      }\n    )\n    uni.reLaunch({\n      url: '/pages/questionnaire/questionnaire?changeMbti=changeMbti',\n    })\n  }\n  //控制弹窗的显示\n  const userPopupRef = ref(null)\n  const popupChange = (e) => {\n    console.log('popupChange', e)\n    console.log('状态', e.show)\n    if (!e.show) {\n      const endTime = new Date().getTime()\n      const duration = endTime - sptime.value\n      dmReport(\n        'stay',\n        {},\n        {\n          contents: [\n            {\n              page: 'userInfo',\n              sptime: duration,\n            },\n          ],\n        }\n      )\n    }\n  }\n  // 暴露方法以便父组件调用\n  const open = async () => {\n    sptime.value = new Date().getTime()\n    dmReport(\n      'pv',\n      {},\n      {\n        contents: [\n          {\n            page: 'userInfo',\n          },\n        ],\n      }\n    )\n    try {\n      const userInfoRes = await request(`${baseUrl}/user/user_info`, 'get')\n      if (userInfoRes.code === 0) {\n        console.log('获取用户信息成功', userInfoRes.data)\n        user.value = userInfoRes.data\n        avator.value = userInfoRes.data.avator\n        toneId.value = userInfoRes.data.tone\n        uni.setStorage({\n          key: 'toneId',\n          data: toneId.value,\n        })\n        userName.value = userInfoRes.data.username\n        userAge.value = calculateAge(userInfoRes.data.birth)\n        userMbtiShort.value = userInfoRes.data.mbti\n        userMbti.value = userInfoRes.data.mbti_ch\n        userSex.value = userInfoRes.data.sex\n        sexSrc.value =\n          userSex.value === '男'\n            ? '../../static/male.png'\n            : '../../static/female.png'\n        // 处理用户信息\n        // 例如：将用户信息存储到状态管理中\n        // 新增：设置初始选中的音色\n        if (toneId.value && tones.value.length > 0) {\n          tones.value.forEach((item) => {\n            // 根据用户的toneId设置音色的active状态\n            item.active = item.id === toneId.value\n            // 如果是当前选中的音色，更新相关状态\n            if (item.active) {\n              selectedToneId.value = item.id\n              currentTone.value = item\n              currentTonePath.value = item.path\n            }\n          })\n        }\n      } else {\n        console.error('获取用户信息失败', userInfoRes.message)\n      }\n    } catch (error) {\n      console.error('打开弹窗失败', error)\n    }\n\n    userPopupRef.value.open('bottom')\n    if (modelStore.model === '金种子杯模式') {\n      const index = tones.value.findIndex((item) => item.id === 6)\n      console.log('打开了音色页面，金种子杯模式')\n      autoClick(6, index)\n    }\n  }\n  const autoClick = (id, index) => {\n    // 点击音色时的处理逻辑\n    console.log('点击音色', id, index)\n    tones.value.forEach((item, i) => {\n      item.active = i === index\n    })\n    selectedToneId.value = id\n    currentTone.value = tones.value[index]\n\n    // 查找对应的音色项\n    const selectedTone = tones.value.find((item) => item.id === id)\n    //更新音色试听的path\n    if (selectedTone) {\n      console.log('选中的音色', selectedTone)\n      currentTonePath.value = selectedTone.path\n    } else {\n      console.error('未找到对应的音色项')\n    }\n  }\n\n  const close = () => {\n    userPopupRef.value.close()\n    console.log('关闭弹窗')\n  }\n\n  // 将方法暴露给父组件\n  defineExpose({\n    open,\n    close,\n  })\n</script>\n\n<style lang=\"scss\" scoped>\n  @import './index.scss';\n</style>\n","import Component from '/Users/lynnyang/work/project/xjlab/HBuilderProjects/bumangyidian/components/user-popup/user-popup.vue'\nwx.createComponent(Component)"],"names":["useModelStore","useToggleModelStore","useWebSocketStore","useAudioPlayerStore","useBarrageStore","ref","onShow","request","baseUrl","uni","dmReport","modelStore"],"mappings":"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"}