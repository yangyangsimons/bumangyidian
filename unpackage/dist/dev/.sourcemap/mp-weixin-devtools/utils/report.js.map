{"version":3,"names":["Proxy","get","_","key","Error","concat","commonParams","getApp","globalData","_pages","dmReport","_x","_dmReport","apply","arguments","_asyncToGenerator2","_regeneratorRuntime2","mark","_callee","type","data","options","token","defaultHeader","_args","wrap","_callee$","_context","prev","next","length","undefined","getCurrentPages","common_vendor","index","getStorageSync","Authorization","is_yk","t0","JSON","t1","_objectSpread2","t2","t3","event","lob","getCommonParams","t4","sent","t5","t6","t7","stringify","call","t8","t9","utils_config","baseUrl","t10","t11","t12","t13","t14","getNetworkType","t15","t16","lastp","network","t17","t18","t19","t20","t21","t22","t23","method","url","header","request","stop","_getNetworkType","_callee2","_callee2$","_context2","abrupt","Promise","resolve","complete","res","networkType","_getCommonParams","_callee4","_callee4$","_context4","getSystemInfo","success","_success","_callee3","_a","_b","_c","sessionid","launchParams","rch","_callee3$","_context3","Date","now","Math","random","toString","substring","getLaunchOptionsSync","query","deviceId","screenWidth","screenHeight","appVersion","system","split","model","dist_ch","platform","did","width","height","ts","app_ver","os","os_ver","net","_x2"],"sources":["consumers","report.js"],"sourcesContent":["export default new Proxy({}, {\n  get(_, key) {\n    throw new Error(`Module \"stream/consumers\" has been externalized for browser compatibility. Cannot access \"stream/consumers.${key}\" in client code.  See https://vitejs.dev/guide/troubleshooting.html#module-externalized-for-browser-compatibility for more details.`)\n  }\n})","import { json } from 'stream/consumers'\nimport { baseUrl } from './config'\nlet commonParams = null\n\n// type: 'pv' | 'show' | 'click' | 'st',\n// data: any = {},\n// options: any = {}\nlet _pages_ = getApp().globalData._pages\nexport async function dmReport(type, data = {}, options = {}) {\n  const pages = getCurrentPages()\n  // const route = pages[pages.length - 1]\n  // switch (_pages_[_pages_.length - 1]) {\n  //   case 'pages/home/home':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitHome'\n  //     break\n  //   case 'pages/my/my':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitMy'\n  //     break\n  //   case 'pages/template-use/template-use':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitcreate'\n  //     break\n  //   case 'pages/ai-generator-index/ai-generator-index':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitList'\n  //     break\n  //   case 'pages/hd-page/hd-page':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitDetail'\n  //     break\n  //   case 'pages/edit_photo/index':\n  //     _pages_[_pages_.length - 1] = 'shubo_portraitEditIDPhoto'\n  //     break\n  //   default:\n  //     break\n  // }\n  // console.log('pages_____', _pages_)\n  const token = uni.getStorageSync('token') || ''\n\n  // 设置请求头，加入token\n  const defaultHeader = {\n    'Content-Type': 'application/json',\n    Authorization: token ? `bearer ${token}` : '', // 常见的token携带方式\n    is_yk: token ? '0' : '1',\n  }\n  const systemData = JSON.stringify({\n    event: type,\n    lob: data,\n    // lastpage: _pages_[_pages_.length - 1] || '',\n    ...(await getCommonParams()), // 公共参数\n    ...options,\n  })\n  uni.request({\n    method: 'POST',\n    url: `${baseUrl}/track/send`,\n    data: JSON.stringify({\n      lastp: 'index',\n      event: type,\n      lob: data,\n      network: await getNetworkType(),\n      // lastpage: _pages_[_pages_.length - 1] || '',\n      ...(await getCommonParams()), // 公共参数\n      ...options,\n    }),\n    header: defaultHeader,\n  })\n}\n\nasync function getNetworkType() {\n  return new Promise((resolve) => {\n    uni.getNetworkType({\n      complete: (res) => resolve(res.networkType || ''),\n    })\n  })\n}\n\nasync function getCommonParams() {\n  if (commonParams) return commonParams\n  return new Promise((resolve) => {\n    uni.getSystemInfo({\n      success: async (res) => {\n        const sessionid = Date.now() + Math.random().toString(36).substring(2)\n        const launchParams = uni.getLaunchOptionsSync()\n        const rch = launchParams?.query?.rch || ''\n\n        commonParams = {\n          sessionid,\n          rch,\n          dist_ch: 'SHXZ-WX',\n          platform: 'miniprogram',\n          did: res.deviceId,\n          width: res.screenWidth,\n          height: res.screenHeight,\n          ts: Date.now(),\n          app_ver: res.appVersion,\n          os: res.system?.split(' ')[0],\n          os_ver: res.system?.split(' ')[1],\n          model: res.model,\n          net: await getNetworkType(),\n        }\n        resolve(commonParams)\n      },\n    })\n  })\n}\n"],"mappings":";;;;;;;;AAAe,IAAIA,KAAA,CAAM,IAAI;EAC3BC,GAAA,WAAAA,IAAIC,CAAA,EAAGC,GAAA,EAAK;IACV,MAAM,IAAIC,KAAA,kHAAAC,MAAA,CAAoHF,GAAG,2IAAsI;EACxQ;AACH,CAAC;ACFD,IAAIG,YAAA,GAAe;AAKLC,MAAA,EAAQ,CAACC,UAAA,CAAWC,MAAA;AAAA,SACZC,SAAAC,EAAA;EAAA,OAAAC,SAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAF,UAAA;EAAAA,SAAA,GAAAG,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAf,SAAAC,QAAwBC,IAAA;IAAA,IAAAC,IAAA;MAAAC,OAAA;MAAAC,KAAA;MAAAC,aAAA;MAAAC,KAAA,GAAAV,SAAA;IAAA,OAAAE,oBAAA,GAAAS,IAAA,UAAAC,SAAAC,QAAA;MAAA,kBAAAA,QAAA,CAAAC,IAAA,GAAAD,QAAA,CAAAE,IAAA;QAAA;UAAMT,IAAA,GAAAI,KAAA,CAAAM,MAAA,QAAAN,KAAA,QAAAO,SAAA,GAAAP,KAAA,MAAO;UAAIH,OAAA,GAAAG,KAAA,CAAAM,MAAA,QAAAN,KAAA,QAAAO,SAAA,GAAAP,KAAA,MAAU;UAC1CQ,eAAA,EAAiB;UAyBzBV,KAAA,GAAQW,aAAA,CAAGC,KAAA,CAACC,cAAA,CAAe,OAAO,KAAK;UAGvCZ,aAAA,GAAgB;YACpB,gBAAgB;YAChBa,aAAA,EAAed,KAAA,aAAAjB,MAAA,CAAkBiB,KAAK,IAAK;YAAA;YAC3Ce,KAAA,EAAOf,KAAA,GAAQ,MAAM;UACtB;UAAAK,QAAA,CAAAW,EAAA,GACkBC,IAAA;UAAAZ,QAAA,CAAAa,EAAA,GAAAC,cAAA;UAAAd,QAAA,CAAAe,EAAA,GAAAD,cAAA;UAAAd,QAAA,CAAAgB,EAAA;YACjBC,KAAA,EAAOzB,IAAA;YACP0B,GAAA,EAAKzB;UAAA;UAAAO,QAAA,CAAAE,IAAA;UAAA,OAEKiB,eAAA,EAAiB;QAAA;UAAAnB,QAAA,CAAAoB,EAAA,GAAApB,QAAA,CAAAqB,IAAA;UAAArB,QAAA,CAAAsB,EAAA,OAAAtB,QAAA,CAAAe,EAAA,EAAAf,QAAA,CAAAgB,EAAA,EAAAhB,QAAA,CAAAoB,EAAA;UAAApB,QAAA,CAAAuB,EAAA,GACxB7B,OAAA;UAAAM,QAAA,CAAAwB,EAAA,OAAAxB,QAAA,CAAAa,EAAA,EAAAb,QAAA,CAAAsB,EAAA,EAAAtB,QAAA,CAAAuB,EAAA;UAAAvB,QAAA,CAAAW,EAAA,CALmBc,SAAA,CAAAC,IAAA,CAAA1B,QAAA,CAAAW,EAAA,EAAAX,QAAA,CAAAwB,EAAA;UAAAxB,QAAA,CAAA2B,EAAA,GAOxBrB,aAAA,CAAAC,KAAA;UAAAP,QAAA,CAAA4B,EAAA,MAAAlD,MAAA,CAEUmD,YAAA,CAAOC,OAAA;UAAA9B,QAAA,CAAA+B,GAAA,GACTnB,IAAA;UAAAZ,QAAA,CAAAgC,GAAA,GAAAlB,cAAA;UAAAd,QAAA,CAAAiC,GAAA,GAAAnB,cAAA;UAAAd,QAAA,CAAAkC,GAAA,GAEG1C,IAAA;UAAAQ,QAAA,CAAAmC,GAAA,GACF1C,IAAA;UAAAO,QAAA,CAAAE,IAAA;UAAA,OACUkC,cAAA,EAAgB;QAAA;UAAApC,QAAA,CAAAqC,GAAA,GAAArC,QAAA,CAAAqB,IAAA;UAAArB,QAAA,CAAAsC,GAAA;YAH/BC,KAAA,EAAO;YACPtB,KAAA,EAAAjB,QAAA,CAAAkC,GAAA;YACAhB,GAAA,EAAAlB,QAAA,CAAAmC,GAAA;YACAK,OAAA,EAAAxC,QAAA,CAAAqC;UAAA;UAAArC,QAAA,CAAAE,IAAA;UAAA,OAEUiB,eAAA,EAAiB;QAAA;UAAAnB,QAAA,CAAAyC,GAAA,GAAAzC,QAAA,CAAAqB,IAAA;UAAArB,QAAA,CAAA0C,GAAA,OAAA1C,QAAA,CAAAiC,GAAA,EAAAjC,QAAA,CAAAsC,GAAA,EAAAtC,QAAA,CAAAyC,GAAA;UAAAzC,QAAA,CAAA2C,GAAA,GACxBjD,OAAA;UAAAM,QAAA,CAAA4C,GAAA,OAAA5C,QAAA,CAAAgC,GAAA,EAAAhC,QAAA,CAAA0C,GAAA,EAAA1C,QAAA,CAAA2C,GAAA;UAAA3C,QAAA,CAAA6C,GAAA,GAAA7C,QAAA,CAAA+B,GAAA,CAPMN,SAAA,CAAAC,IAAA,CAAA1B,QAAA,CAAA+B,GAAA,EAAA/B,QAAA,CAAA4C,GAAA;UAAA5C,QAAA,CAAA8C,GAAA,GASHlD,aAAA;UAAAI,QAAA,CAAA+C,GAAA;YAXRC,MAAA,EAAQ;YACRC,GAAA,EAAAjD,QAAA,CAAA4B,EAAA;YACAnC,IAAA,EAAAO,QAAA,CAAA6C,GAAA;YASAK,MAAA,EAAAlD,QAAA,CAAA8C;UAAA;UAAA9C,QAAA,CAAA2B,EAAA,CAZEwB,OAAA,CAAAzB,IAAA,CAAA1B,QAAA,CAAA2B,EAAA,EAAA3B,QAAA,CAAA+C,GAAA;QAAA;QAAA;UAAA,OAAA/C,QAAA,CAAAoD,IAAA;MAAA;IAAA,GAAA7D,OAAA;EAAA,CAcN;EAAA,OAAAN,SAAA,CAAAC,KAAA,OAAAC,SAAA;AAAA;AAAA,SAEeiD,eAAA;EAAA,OAAAiB,eAAA,CAAAnE,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAAkE,gBAAA;EAAAA,eAAA,GAAAjE,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAf,SAAAgE,SAAA;IAAA,OAAAjE,oBAAA,GAAAS,IAAA,UAAAyD,UAAAC,SAAA;MAAA,kBAAAA,SAAA,CAAAvD,IAAA,GAAAuD,SAAA,CAAAtD,IAAA;QAAA;UAAA,OAAAsD,SAAA,CAAAC,MAAA,WACS,IAAIC,OAAA,CAAQ,UAACC,OAAA,EAAY;YAC9BrD,aAAA,CAAAC,KAAA,CAAI6B,cAAA,CAAe;cACjBwB,QAAA,EAAU,SAAVA,SAAWC,GAAA;gBAAA,OAAQF,OAAA,CAAQE,GAAA,CAAIC,WAAA,IAAe,EAAE;cAAA;YACtD,CAAK;UACL,CAAG;QAAA;QAAA;UAAA,OAAAN,SAAA,CAAAJ,IAAA;MAAA;IAAA,GAAAE,QAAA;EAAA,CACH;EAAA,OAAAD,eAAA,CAAAnE,KAAA,OAAAC,SAAA;AAAA;AAAA,SAEegC,gBAAA;EAAA,OAAA4C,gBAAA,CAAA7E,KAAA,OAAAC,SAAA;AAAA;AAAA,SAAA4E,iBAAA;EAAAA,gBAAA,GAAA3E,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAf,SAAA0E,SAAA;IAAA,OAAA3E,oBAAA,GAAAS,IAAA,UAAAmE,UAAAC,SAAA;MAAA,kBAAAA,SAAA,CAAAjE,IAAA,GAAAiE,SAAA,CAAAhE,IAAA;QAAA;UAAA,KACMvB,YAAA;YAAAuF,SAAA,CAAAhE,IAAA;YAAA;UAAA;UAAA,OAAAgE,SAAA,CAAAT,MAAA,WAAqB9E,YAAA;QAAA;UAAA,OAAAuF,SAAA,CAAAT,MAAA,WAClB,IAAIC,OAAA,CAAQ,UAACC,OAAA,EAAY;YAC9BrD,aAAA,CAAAC,KAAA,CAAI4D,aAAA,CAAc;cAChBC,OAAA;gBAAA,IAAAC,QAAA,GAAAjF,kBAAA,eAAAC,oBAAA,GAAAC,IAAA,CAAS,SAAAgF,SAAOT,GAAA;kBAAA,IAAAU,EAAA,EAAAC,EAAA,EAAAC,EAAA,EAAAC,SAAA,EAAAC,YAAA,EAAAC,GAAA;kBAAA,OAAAvF,oBAAA,GAAAS,IAAA,UAAA+E,UAAAC,SAAA;oBAAA,kBAAAA,SAAA,CAAA7E,IAAA,GAAA6E,SAAA,CAAA5E,IAAA;sBAAA;wBACRwE,SAAA,GAAYK,IAAA,CAAKC,GAAA,EAAG,GAAKC,IAAA,CAAKC,MAAA,EAAQ,CAACC,QAAA,CAAS,EAAE,EAAEC,SAAA,CAAU,CAAC;wBAC/DT,YAAA,GAAerE,aAAA,CAAGC,KAAA,CAAC8E,oBAAA,EAAsB;wBACzCT,GAAA,KAAML,EAAA,GAAAI,YAAA,oBAAAA,YAAA,CAAcW,KAAA,KAAd,gBAAAf,EAAA,CAAqBK,GAAA,KAAO;wBAAAE,SAAA,CAAAnE,EAAA,GAGtC+D,SAAA;wBAAAI,SAAA,CAAAjE,EAAA,GACA+D,GAAA;wBAAAE,SAAA,CAAA/D,EAAA,GAGK8C,GAAA,CAAI0B,QAAA;wBAAAT,SAAA,CAAA9D,EAAA,GACF6C,GAAA,CAAI2B,WAAA;wBAAAV,SAAA,CAAA1D,EAAA,GACHyC,GAAA,CAAI4B,YAAA;wBAAAX,SAAA,CAAAxD,EAAA,GACRyD,IAAA,CAAKC,GAAA,EAAK;wBAAAF,SAAA,CAAAvD,EAAA,GACLsC,GAAA,CAAI6B,UAAA;wBAAAZ,SAAA,CAAAtD,EAAA,GACb,CAAIgD,EAAA,GAAAX,GAAA,CAAI8B,MAAA,KAAJ,gBAAAnB,EAAA,CAAYoB,KAAA,CAAM,KAAK;wBAAAd,SAAA,CAAAnD,EAAA,GAC3B,CAAQ8C,EAAA,GAAAZ,GAAA,CAAI8B,MAAA,KAAJ,gBAAAlB,EAAA,CAAYmB,KAAA,CAAM,KAAK;wBAAAd,SAAA,CAAAlD,EAAA,GACxBiC,GAAA,CAAIgC,KAAA;wBAAAf,SAAA,CAAA5E,IAAA;wBAAA,OACAkC,cAAA,EAAgB;sBAAA;wBAAA0C,SAAA,CAAA/C,GAAA,GAAA+C,SAAA,CAAAzD,IAAA;wBAb7B1C,YAAA;0BACE+F,SAAA,EAAAI,SAAA,CAAAnE,EAAA;0BACAiE,GAAA,EAAAE,SAAA,CAAAjE,EAAA;0BACAiF,OAAA,EAAS;0BACTC,QAAA,EAAU;0BACVC,GAAA,EAAAlB,SAAA,CAAA/D,EAAA;0BACAkF,KAAA,EAAAnB,SAAA,CAAA9D,EAAA;0BACAkF,MAAA,EAAApB,SAAA,CAAA1D,EAAA;0BACA+E,EAAA,EAAArB,SAAA,CAAAxD,EAAA;0BACA8E,OAAA,EAAAtB,SAAA,CAAAvD,EAAA;0BACA8E,EAAA,EAAAvB,SAAA,CAAAtD,EAAA;0BACA8E,MAAA,EAAAxB,SAAA,CAAAnD,EAAA;0BACAkE,KAAA,EAAAf,SAAA,CAAAlD,EAAA;0BACA2E,GAAA,EAAAzB,SAAA,CAAA/C;wBAAA;wBAEF4B,OAAA,CAAQhF,YAAY;sBAAA;sBAAA;wBAAA,OAAAmG,SAAA,CAAA1B,IAAA;oBAAA;kBAAA,GAAAkB,QAAA;gBAAA,CACrB;gBAAA,SArBDF,QAAAoC,GAAA;kBAAA,OAAAnC,QAAA,CAAAnF,KAAA,OAAAC,SAAA;gBAAA;gBAAA,OAAAiF,OAAA;cAAA;YAsBN,CAAK;UACL,CAAG;QAAA;QAAA;UAAA,OAAAF,SAAA,CAAAd,IAAA;MAAA;IAAA,GAAAY,QAAA;EAAA,CACH;EAAA,OAAAD,gBAAA,CAAA7E,KAAA,OAAAC,SAAA;AAAA","ignoreList":[]}